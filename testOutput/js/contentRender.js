/*! lxapp 2015-12-30 */
!function(a){function b(a){"undefined"==typeof a&&(a=100),window.scrollTo(0,l.scrollTop()+1),setTimeout(function(){window.scrollTo(0,l.scrollTop()-1)},a)}function c(a){var b="magnificPopupScript",c=$("#"+b);c.length>0?a():($("<link>").attr({type:"text/css",rel:"stylesheet",href:"http://s0.qhimg.com/!51b589d0/magnific-popup.css"}).appendTo("head"),$("<script>").attr({id:b,src:"http://s9.qhimg.com/!1a5e34b7/jquery.magnific-popup.js"}).on("load",a).appendTo("body"))}function d(b,c,d,e,f,g){var h,i,j=new Date,l=$(b).html(),n="function"==typeof e?e(c):c,o="";if(console.log(n),g=g||$(".wrapper").last(),null==n)return o;if($.isEmptyObject(n)||($datum[b.replace(/^#|\-tmpl/g,"")]=n),!l)return i="template "+b+" is missing or empty!",console.error(i),"<p>"+i+"</p>";var p=[];n.content&&($.each(n.content,function(a,b){"txt"==b.type?$.trim(b.value)&&p.push(b):p.push(b)}),n.content=p);try{if(o=ejs.compile(l)(n,{compileDebug:!0}),f)return o;h=$(o),d?(k=[],g.html(h)):g.append(h),g.trigger("partDone",[b,n]),k.push(h[0])}catch(q){if(a.$debug===!0)throw q.message="error while compiling "+b+":"+q.message,q}var r=new Date,s=r-j;return m+=s,a.$debug&&console.log("//Profiling: Render "+b+" use "+(r-j)+"ms"),this}function e(b,c,d){var e,f="#"+b+"-tmpl",g=$(f).html(),h="function"==typeof d?d(c):c;if(null==h)return this;if(!g)return console.error("template "+f+" is missing or empty!"),this;$.isEmptyObject(h)||($datum.mod[f.replace(/^#|\-tmpl/g,"")]=h);try{e=ejs.compile(g)(h,{ompileDebug:!0})}catch(i){if(a.$debug===!0)throw i.message="error while compiling "+f+":"+i.message,i}return e}function f(a,b){return function(c,e){return d.call(j,a,c,e,null,!1,b?b():null)}}function g(b){c(function(){var c=b.attr("data-trans-url");b.attr("data-allqimg")>8&&c?$.ajax({url:c,dataType:"jsonp",success:function(a){if(a&&a.data&&a.data.content){var c=$.extend({},o);c.index=7,c.items=b.find("a[data-mfp-src]").toArray();var d=0;$.each(a.data.content,function(a,b){"img"==b.type&&(d++,d>8&&c.items.push({src:b.value}))}),b.magnificPopup(c)}else b.magnificPopup(o)},error:function(){a.$debug===!0&&console.log("initGalleryMagnificPopup error")}}):b.magnificPopup(o)})}function h(a,b,c,d){var e,f=c.replace(/<p[\s\S]*?>([\s\S]*?)<\/p>/g,"$1").replace(/\}<br\/>/,"}"),g={},h=b-20;if(f&&f.length>=2)try{e=JSON.parse(f),g=$.isArray(e)?{items:e}:e}catch(i){console.error(i.toString())}if("gallery"==a){var j;try{j=JSON.parse(d.transUrls)}catch(i){}j=j||[],$.each(g.items,function(a,b){b.transUrl=j[a],b.items=b.imgurl.split("|"),b.data=JSON.stringify(b);var c=1,d=0;l=b.imgWidth=Math.floor((h-d)/c),n=b.items.length,b.imgHeight=Math.floor(3*l/4),b.itemPerPage=c,b.scrollerWidth=(l+5)*n-5,b.originalPhotos=b.items,b.items=b.items.map(function(a){return $utils.dmfd(a,l,b.imgHeight,!0)}),b.total=b.items.length})}else if("further-reading"==a)g.scrollerWidth=h*g.items.length,g.itemWidth=h,g.items=g.items.map(function(a){return a.summary=$utils.unescape(a.summary),a});else if("wiki"==a)g.items=g.items.map(function(a){var b=a.rawSummary=$utils.unescape(a.summary);return a.summary=b,a.imgurl=$utils.dmfd(a.imgurl,62,65,!0),b.length>100&&(a.summary=b.substr(0,100)+"..."),a});else if("weibo"==a){var k=3,l=g.imgWidth=Math.floor((h-10)/k);g.imgHeight=Math.floor(3*l/4),g.items.forEach(function(a){var b=a.created_at.indexOf("-")>0?a.created_at:Date.parse(a.created_at);a.date=$utils.formatDate(b),a.text=$utils.unescape(a.text),a.itemPerPage=k;var c=a.pic_urls;a.scrollerWidth=(l+5)*c.length-5,a.originalPhotos=c.map(function(a){return a.thumbnail_pic}),a.photos=c.map(function(a){return $utils.dmfd(a.thumbnail_pic,l,g.imgHeight,!0)}),a.data=a.originalPhotos.join("|"),a.src||(a.src="javascript:;")})}else if("video"==a)g.w=h,g.h=(h/1.777).toFixed(0),g.items.forEach(function(a){a.url=a.url,a.imgurl=$utils.dmfd(a.imgurl,g.w,g.h,!0)});else if("news-feature"==a){if("big"==g.pattern){var m=g.items[0].imgshow;g.logo||(g.logo={}),g.logo.title||(daata.logo.title="进入专题"),g.items[0].summary=$utils.unescape(g.items[0].summary),g.items[0].imgshow=$utils.dmt(m,h,150,!0)}}else if("shixian"==a){var o=function(a){var b={"一":"01","二":"02","三":"03","四":"04","五":"05","六":"06","七":"07","八":"08","九":"09","十":"10"},c=parseInt(a,10);return isNaN(c)?b[a]||"":10>c?"0"+c:c};isNaN(g.sequence)?-1!==g.sequence.indexOf("看点")?g.sequence=o(g.sequence.substr(2))||"":g.sequence="":g.sequence=o(g.sequence),g.summary&&(g.summary=g.summary.replace(/\n/g,"<br>")),$.isArray(g.items)&&$.each(g.items,function(a,b){g.items[a].imgurl=b.imgurl&&$utils.dmfd(b.imgurl,100,75)})}return g}function i(a){return'<p style="white-space: normal;"></p>'==a||'<p style="white-space: normal;"><br/></p>'==a}var j={},k=[],l=$(window),m=($(document),0);$.noop=function(){},a.$pageHPadding=16,a.$isWeixin=navigator.userAgent.toLowerCase().indexOf("micromessenger")>0,a.$is360Browser=navigator.userAgent.indexOf("360")>=0,a.$isShixianInstalled=location.search.indexOf("isappinstalled")>0,a.$datum={mod:{}},ejs.open="{%",ejs.close="%}",$&&$.fn&&!$.fn.tap&&($.fn.tap=$.fn.click);var o={delegate:"a[data-mfp-src]",type:"image",closeOnContentClick:!1,closeBtnInside:!1,mainClass:"mfp-with-zoom mfp-img-mobile",image:{verticalFit:!1},gallery:{enabled:!0},zoom:{enabled:!0,duration:300,opener:function(a){return a.find?a.find("img"):$(a.img[0])}},callbacks:{open:function(a){document.body.scrollTop+=1,document.body.scrollTop-=1}}};j.render=d,j.makeNoPreprocessRender=f;var p={dajiasou:"mod",shixian:"mod",wiki:"mod",weibo:"mod",music:"mod",gallery:"mod",video:"mod","further-reading":"mod",blockquote:"mod","n-slash-total":"part","editor-comment":"part",headimg:"part"};j.renderGrayBar=function(b,c,e){return a.$debug===!0&&console.log("$ContentRender.renderGrayBar("+JSON.stringify(b)+");"),d.call(this,"#grayBar-tmpl",b,e,function(a){c="undefined"==typeof c?!0:!!c;var b={tagData:$.extend(!0,[],a.transmit_data)};return b.transmit_num=a.transmit_num?a.transmit_num:"",b},"",$("#sx-graybar"))},j.renderArticle=function(b,c,f){a.$debug===!0&&console.log("$ContentRender.renderArticle("+JSON.stringify(b)+");");var j=$(".wrapper"),k=j.width()-2*$pageHPadding;c="undefined"==typeof c?!0:!!c;var l,m=[],n=d.call(this,"#article-tmpl",b,f,function(a){var b,d,f,g,j={content:$.extend(!0,[],a.content)};for(a.time&&(isNaN(a.time)||a.time>0)?j.time=$utils.formatDate(a.time):j.time="",a.wapurl&&c&&(j.origin=a.wapurl),a.nid&&(j.nid=a.nid),a.title&&(j.title=$utils.unescape(a.title),document.title=j.title),a.newtags&&a.newtags.length>0&&(j.tags=a.newtags.split("|")),a.source&&(j.source=a.source),a.editor_pic&&(j.editor_pic=$utils.dmfd(a.editor_pic,60,60)),a.editor_name&&(j.editor_name=a.editor_name),a.editor_desc&&(j.editor_desc=a.editor_desc),a.editor_comment&&(j.editor_comment=a.editor_comment),b=0;j.content&&b<j.content.length;++b)if(d=j.content[b],"img"==d.type){if(d.originalValue=d.value,f=d.value.match(/size=(\d+).*?(\d+)/),!f){console.error("DataError!image missing dimension:"+d.value);continue}k<f[1]?(g=k/f[1],d.width=k,d.height=Math.floor(g*f[2])):(d.width=f[1],d.height=f[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)}else if("txt"==d.type)"img_title"==d.subtype?d.cssClass="caption":"head"==d.subtype?d.cssClass="head":(d.cssClass="normal",i(d.value)&&(d.value=null)),d.value&&d.value.match(/^\s*<p/)?d.noPTag=!0:d.noPTag=!1,d.value&&(d.value=$utils.unescape(d.value));else if("undefined"!=typeof p[d.type]){var n=h(d.type,k,d.value,d),o=p[d.type];"headimg"==d.type?(n.url&&(f=n.url.match(/size=(\d+).*?(\d+)/),k<f[1]?(g=k/f[1],d.width=k,d.height=Math.floor(g*f[2])):(d.width=f[1],d.height=f[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)),l=e(o?o+"-"+d.type:d.type,n),j.content.splice(b,1),b--):"video"==d.type?(m.push(e(o?o+"-"+d.type:d.type,n)),j.content.splice(b,1)):(1==n.showeditor&&(n._editorData={editor_pic:j.editor_pic,editor_name:j.editor_name,editor_desc:j.editor_desc}),d.value=e(o?o+"-"+d.type:d.type,n),d.type="html")}return j},"",$("#sx-article"));return m.length&&m.forEach(function(a){j.find("#video").append(a)}),l&&j.find(".article").prepend(l),window.$wap&&g($(".mod .gallery")),n},j.renderRecommendArtices=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderRecommendArtices("+JSON.stringify(b)+");");var e=$(".wrapper"),f=e.width()-2*$pageHPadding;return d.call(this,"#recommend-articles-tmpl",b,c,function(a){return a.related&&a.related.length>0&&a.related.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.source=a.src,a.album_pic?(a.imgurl=a.album_pic.split("|")[0],a.width=Math.floor((f-15)/2),a.height=f/3,a.img=$utils.dmfd(a.imgurl,a.width,a.height)):a.img=a.imgurl}),a},"",$("#sx-recommond"))},j.renderhotArtices=function(b,c){window.detListData=b,a.$debug===!0&&console.log("$ContentRender.renderhotArtices("+JSON.stringify(b)+");");var e=$(".wrapper");e.width()-2*$pageHPadding;return d.call(this,"#hot-articles-tmpl",b,c,function(a){return a.hotNewsList&&a.hotNewsList.length>0&&a.hotNewsList.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.source=a.src,a.album_pic?(a.imgurl=a.album_pic.split("|")[0],a.width=110,a.height=82,a.img=$utils.dmfd(a.imgurl,a.width,a.height)):a.img=a.imgurl}),a},"",$("#sx-hot"))},j.renderComments=function(b,c,e){return a.$debug===!0&&console.log("$ContentRender.renderComments("+JSON.stringify(b)+");"),d.call(this,"#comments-tmpl",b,c,function(a){var b;return a.hot_comments&&a.hot_comments.length>0?(b="热门评论",a._comments=a.hot_comments,a.more="查看更多评论"):a.comments&&a.comments.length>0?(b="最新评论",a._comments=a.comments,a.comment_num>3&&(a.more="查看更多评论")):(b="最新评论",a._comments=[]),!a.title&&b&&(a.title=b),a._comments&&a._comments.length>3&&(a._comments.length=3),a._comments.forEach(function(a){a.text=decodeURIComponent(a.comment),a.username=decodeURIComponent(a.uname),a.liked=a.support||0,a.cid=a.comment_id,a.time=$utils.elapse(a.create_time),a.avatarUrl=decodeURIComponent(a.uavatar)||null}),a},e,$("#sx-comments"))},j.refreshComments=function(a){for(var b,c=j.renderComments(a,!1,!0),d=0,e=k.length;e>d;++d)b=$(k[d]),b.attr("class").indexOf("comments")>=0&&b.replaceWith(c)},j.prependComment=function(a){var b,c,d,e={hot_comments:[a]},f=$(".comments.part");f.find(".no-comments").hide(),b=f.find(".comment-list").show(),c=this.renderComments(e,!1,!0),d=$(c).find("li"),b.prepend(d)},j.playMusic=function(){},j.stopMusic=function(){$(".wrapper").find(".music .play-button.playing").removeClass("playing").addClass("stop")},j.renderShareButtons=function(b,c){return!a.$wap||a.$isWeixin?d.call(j,"#share-buttons-tmpl",b,c,null,!1):$.noop};var q={time_line:"Timeline"};j.renderExtend=function(b){if(a.$debug===!0&&console.log("$ContentRender.renderExtend("+JSON.stringify(b)+");"),b&&b.data&&(b.data.mood1&&$(".wrapper").trigger("onRenderExtend",[b.data.mood1]),b.data.extend))for(var c,d,e,f=b.data.extend,g=b.data.extend.detailorder.split(","),h=0,i=g.length;i>h;++h)c=g[h],methodName="render"+q[c],d=j[methodName],d?(e=f[c],e?d.call(j,e):console.log("//"+c+" data is missing!")):console.log("//Can not render "+c+", check your spelling")},j.renderCommentsCompose=$.noop,j.done=function(){a.$debug===!0&&console.log("$ContentRender.done();");var b=$(".wrapper");b.trigger("domDone"),b.data("done",!0),console.log("//渲染完成,总耗时"+m+"ms!")},function(b){function c(b,d){var e=new Image,f=b.getAttribute("data-src");e.onload=function(){var a=$(b);a.removeClass("lazy error loading"),a.hasClass("_native-call")&&(a.addClass("native-call"),a.removeClass("_native-call")),b.parent?b.parent.replaceChild(e,b):(b.src=f,$(b).removeClass("lazy")),d&&d()},e.onerror=function(){var a=$(b);a.hasClass("native-call")&&a.addClass("_native-call"),a.addClass("error lazy").removeClass("native-call loading").off("tap").tap(function(){a.addClass("loading"),c(b,d)})},a.$debug&&console.log("//加载"+f),e.src=f}function d(a,b){var c=a.ele.getBoundingClientRect(),d=l.height(),e=l.scrollTop(),f=c.top+e,g=f+c.height;return e>=f?g>=e-d:e+2*d>=f}function e(b){var c=0,d=b.length,e=[];for(a.$debug&&console.log("//懒加载"+d+"张图"),c;d>c;++c)e.push({ele:b[c],rect:b[c].getBoundingClientRect()});return e}function f(a,b){return d(a[b],b)?(c(a[b].ele,function(){a[b]=null}),!0):!1}function g(){var b=new Date;if(null==i&&(i=e($("img.lazy")),a.$debug&&(a.$images=i)),0===i.length)return void(k||(i=null));m=b;for(var c=0,d=0;d<i.length;d++)null!=i[d]?f(i,d):c++;c==i.length&&(i.length=0,k=!0)}var h=function(a,c){b.addEventListener?this.addEventListener(a,c,!1):b.attachEvent?this.attachEvent("on"+a,c):this["on"+a]=c},i=null,k=!1,m=null;h("scroll",g),j.lazyLoadImage=function(){a.$debug===!0&&console.log("$ContentRender.lazyLoadImage();"),g()}}(this);var r={small:"small",normal:"normal",big:"big",extraBig:"extra-big"};a.adjustFontSize=function(a){var c=r[a]||"normal";$(".wrapper").attr("class","wrapper").addClass(c),b()},a.$ContentRender=j}(this);