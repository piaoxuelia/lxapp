/*! lxapp 2015-12-01 */
!function(a){function b(a){"undefined"==typeof a&&(a=100),window.scrollTo(0,m.scrollTop()+1),setTimeout(function(){window.scrollTo(0,m.scrollTop()-1)},a)}function c(a){var b="magnificPopupScript",c=$("#"+b);c.length>0?a():($("<link>").attr({type:"text/css",rel:"stylesheet",href:"/styles/magnific-popup.css"}).appendTo("head"),$("<script>").attr({id:b,src:"/scripts/libs/jquery.magnific-popup.js"}).on("load",a).appendTo("body"))}function d(a,b){"undefined"!=typeof $_news&&"function"==typeof $_news.setData&&(console.log("//setData("+a+","+b+")"),$_news.setData(a,b||""))}function e(b,c,d,e,f,g){var h,i,j=new Date,k=$(b).html(),m="function"==typeof e?e(c):c,o="";if(console.log(m),g=g||$(".wrapper").last(),null==m)return o;if($.isEmptyObject(m)||($datum[b.replace(/^#|\-tmpl/g,"")]=m),!k)return i="template "+b+" is missing or empty!",console.error(i),"<p>"+i+"</p>";var p=[];m.content&&($.each(m.content,function(a,b){"txt"==b.type?$.trim(b.value)&&p.push(b):p.push(b)}),m.content=p);try{if(o=ejs.compile(k)(m,{compileDebug:!0}),f)return o;h=$(o),d?(l=[],g.html(h)):g.append(h),g.trigger("partDone",[b,m]),l.push(h[0])}catch(q){if(a.$debug===!0)throw q.message="error while compiling "+b+":"+q.message,q}var r=new Date,s=r-j;return n+=s,a.$debug&&console.log("//Profiling: Render "+b+" use "+(r-j)+"ms"),this}function f(b,c,d){var e,f="#"+b+"-tmpl",g=$(f).html(),h="function"==typeof d?d(c):c;if(null==h)return this;if(!g)return console.error("template "+f+" is missing or empty!"),this;$.isEmptyObject(h)||($datum.mod[f.replace(/^#|\-tmpl/g,"")]=h);try{e=ejs.compile(g)(h,{ompileDebug:!0})}catch(i){if(a.$debug===!0)throw i.message="error while compiling "+f+":"+i.message,i}return e}function g(a,b){return function(c,d){return e.call(k,a,c,d,null,!1,b?b():null)}}function h(b){c(function(){var c=b.attr("data-trans-url");b.attr("data-allqimg")>8&&c?$.ajax({url:c,dataType:"jsonp",success:function(a){if(a&&a.data&&a.data.content){var c=$.extend({},o);c.index=7,c.items=b.find("a[data-mfp-src]").toArray();var d=0;$.each(a.data.content,function(a,b){"img"==b.type&&(d++,d>8&&c.items.push({src:b.value}))}),b.magnificPopup(c)}else b.magnificPopup(o)},error:function(){a.$debug===!0&&console.log("initGalleryMagnificPopup error")}}):b.magnificPopup(o)})}function i(a,b,c,e){var f,g=c.replace(/<p[\s\S]*?>([\s\S]*?)<\/p>/g,"$1").replace(/\}<br\/>/,"}"),h={},i=b-20;if(g&&g.length>=2)try{f=JSON.parse(g),h=$.isArray(f)?{items:f}:f}catch(j){console.error(j.toString())}if("gallery"==a){var k;try{k=JSON.parse(e.transUrls)}catch(j){}k=k||[],$.each(h.items,function(a,b){b.transUrl=k[a],b.items=b.imgurl.split("|"),b.data=JSON.stringify(b);var c=3,d=b.imgWidth=Math.floor((i-10)/c),e=b.items.length;b.imgHeight=Math.floor(3*d/4),b.itemPerPage=c,b.scrollerWidth=(d+5)*e-5,b.originalPhotos=b.items,b.items=b.items.map(function(a){return $utils.dmfd(a,d,b.imgHeight,!0)}),b.total=b.items.length})}else if("further-reading"==a)h.scrollerWidth=i*h.items.length,h.itemWidth=i,h.items=h.items.map(function(a){return a.summary=$utils.unescape(a.summary),a});else if("wiki"==a)h.items=h.items.map(function(a){var b=a.rawSummary=$utils.unescape(a.summary);return a.summary=b,a.imgurl=$utils.dmfd(a.imgurl,62,65,!0),b.length>100&&(a.summary=b.substr(0,100)+"..."),a});else if("weibo"==a){var l=3,m=h.imgWidth=Math.floor((i-10)/l);h.imgHeight=Math.floor(3*m/4),h.items.forEach(function(a){var b=a.created_at.indexOf("-")>0?a.created_at:Date.parse(a.created_at);a.date=$utils.formatDate(b),a.text=$utils.unescape(a.text),a.itemPerPage=l;var c=a.pic_urls;a.scrollerWidth=(m+5)*c.length-5,a.originalPhotos=c.map(function(a){return a.thumbnail_pic}),a.photos=c.map(function(a){return $utils.dmfd(a.thumbnail_pic,m,h.imgHeight,!0)}),a.data=a.originalPhotos.join("|"),a.src||(a.src="javascript:;")})}else if("video"==a)h.w=i,h.h=(i/1.777).toFixed(0),h.items.forEach(function(a){a.url=a.url,a.imgurl=$utils.dmfd(a.imgurl,h.w,h.h,!0)});else if("news-feature"==a){if("big"==h.pattern){var n=h.items[0].imgshow;h.logo||(h.logo={}),h.logo.title||(daata.logo.title="进入专题"),h.items[0].summary=$utils.unescape(h.items[0].summary),h.items[0].imgshow=$utils.dmt(n,i,150,!0)}}else if("headimg"==a)h.url=$utils.dmfd(h.url,i,(i/2.4).toFixed(0),!0),d("headimg",h.url);else if("dajiasou"==a)h.items=h.content.split("\n");else if("kandian"==a){var o=function(a){var b={"一":"01","二":"02","三":"03","四":"04","五":"05","六":"06","七":"07","八":"08","九":"09","十":"10"},c=parseInt(a,10);return isNaN(c)?b[a]||"":10>c?"0"+c:c};isNaN(h.sequence)?-1!==h.sequence.indexOf("看点")?h.sequence=o(h.sequence.substr(2))||"":h.sequence="":h.sequence=o(h.sequence),h.summary&&(h.summary=h.summary.replace(/\n/g,"<br>")),$.isArray(h.items)&&$.each(h.items,function(a,b){h.items[a].imgurl=b.imgurl&&$utils.dmfd(b.imgurl,100,75)})}return h}function j(a){return'<p style="white-space: normal;"></p>'==a||'<p style="white-space: normal;"><br/></p>'==a}var k={},l=[],m=$(window),n=($(document),0);$.noop=function(){},a.$pageHPadding=16,a.$isWeixin=navigator.userAgent.toLowerCase().indexOf("micromessenger")>0,a.$is360Browser=navigator.userAgent.indexOf("360")>=0,a.$isKandianInstalled=location.search.indexOf("isappinstalled")>0,a.$datum={mod:{}},ejs.open="{%",ejs.close="%}",$&&$.fn&&!$.fn.tap&&($.fn.tap=$.fn.click);var o={delegate:"a[data-mfp-src]",type:"image",closeOnContentClick:!1,closeBtnInside:!1,mainClass:"mfp-with-zoom mfp-img-mobile",image:{verticalFit:!1},gallery:{enabled:!0},zoom:{enabled:!0,duration:300,opener:function(a){return a.find?a.find("img"):$(a.img[0])}},callbacks:{open:function(a){document.body.scrollTop+=1,document.body.scrollTop-=1}}};k.render=e,k.makeNoPreprocessRender=g;var p={dajiasou:"mod",kandian:"mod",wiki:"mod",weibo:"mod",music:"mod",gallery:"mod",video:"mod","further-reading":"mod",blockquote:"mod","n-slash-total":"part","editor-comment":"part",headimg:"part"};k.renderGrayBar=function(b,c,d){return a.$debug===!0&&console.log("$ContentRender.renderGrayBar("+JSON.stringify(b)+");"),e.call(this,"#grayBar-tmpl",b,d,function(a){c="undefined"==typeof c?!0:!!c;var b={tagData:$.extend(!0,[],a.transmit_data)};return b.transmit_num=a.transmit_num?a.transmit_num:"",b})},k.renderArticle=function(b,c,d){a.$debug===!0&&console.log("$ContentRender.renderArticle("+JSON.stringify(b)+");");var g=$(".wrapper"),k=g.width()-2*$pageHPadding;c="undefined"==typeof c?!0:!!c;var l,m=e.call(this,"#article-tmpl",b,d,function(a){var b,d,e,g,h={content:$.extend(!0,[],a.content)};for(a.time&&(isNaN(a.time)||a.time>0)?h.time=$utils.formatDate(a.time):h.time="",a.wapurl&&c&&(h.origin=a.wapurl),a.nid&&(h.nid=a.nid),a.title&&(h.title=$utils.unescape(a.title),document.title=h.title),a.newtags&&a.newtags.length>0&&(h.tags=a.newtags.split("|")),a.source&&(h.source=a.source),a.editor_pic&&(h.editor_pic=$utils.dmfd(a.editor_pic,60,60)),a.editor_name&&(h.editor_name=a.editor_name),a.editor_desc&&(h.editor_desc=a.editor_desc),a.editor_comment&&(h.editor_comment=a.editor_comment),b=0;h.content&&b<h.content.length;++b)if(d=h.content[b],"img"==d.type){if(d.originalValue=d.value,e=d.value.match(/size=(\d+).*?(\d+)/),!e){console.error("DataError!image missing dimension:"+d.value);continue}k<e[1]?(g=k/e[1],d.width=k,d.height=Math.floor(g*e[2])):(d.width=e[1],d.height=e[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)}else if("txt"==d.type)"img_title"==d.subtype?d.cssClass="caption":"head"==d.subtype?d.cssClass="head":(d.cssClass="normal",j(d.value)&&(d.value=null)),d.value&&d.value.match(/^\s*<p/)?d.noPTag=!0:d.noPTag=!1,d.value&&(d.value=$utils.unescape(d.value));else if("undefined"!=typeof p[d.type]){var m=i(d.type,k,d.value,d),n=p[d.type];"headimg"==d.type?(m.url&&(e=m.url.match(/size=(\d+).*?(\d+)/),k<e[1]?(g=k/e[1],d.width=k,d.height=Math.floor(g*e[2])):(d.width=e[1],d.height=e[2],d.descAlignCenter=!0),d.value=$utils.dmfd(d.value,d.width,d.height,!0)),l=f(n?n+"-"+d.type:d.type,m),h.content.splice(b,1),b--):(1==m.showeditor&&(m._editorData={editor_pic:h.editor_pic,editor_name:h.editor_name,editor_desc:h.editor_desc}),d.value=f(n?n+"-"+d.type:d.type,m),d.type="html")}return h});return l&&g.find(".article").prepend(l),$(".mod .cont").each(function(b,c){var d=new IScroll(c,{eventPassthrough:!0,scrollX:!0,scrollY:!1,preventDefault:!1,mouseWheel:!0,snap:!0});d.on("scrollEnd",function(){var a=this.currentPage.pageX,b=$(this.wrapper).find(".dots-indicator").children().removeClass("current");$(b[a]).addClass("current")}),(a.$wap||a.$pc)&&$(c).hasClass("gallery")&&h($(c)),g.trigger("onCreateIScroll",[d,"in_article"])}),m},k.renderComments=function(b,c,d){return a.$debug===!0&&console.log("$ContentRender.renderComments("+JSON.stringify(b)+");"),e.call(this,"#comments-tmpl",b,c,function(a){var b;return a.hot_comments&&a.hot_comments.length>0?(b="热门评论",a._comments=a.hot_comments,a.more="查看更多评论"):a.comments&&a.comments.length>0?(b="最新评论",a._comments=a.comments,a.comment_num>3&&(a.more="查看更多评论")):(b="最新评论",a._comments=[]),!a.title&&b&&(a.title=b),a._comments&&a._comments.length>3&&(a._comments.length=3),a._comments.forEach(function(a){a.text=decodeURIComponent(a.comment),a.username=decodeURIComponent(a.uname),a.liked=a.support||0,a.cid=a.comment_id,a.time=$utils.elapse(a.create_time),a.avatarUrl=decodeURIComponent(a.uavatar)||null}),a},d)},k.refreshComments=function(a){for(var b,c=k.renderComments(a,!1,!0),d=0,e=l.length;e>d;++d)b=$(l[d]),b.attr("class").indexOf("comments")>=0&&b.replaceWith(c)},k.prependComment=function(a){var b,c,d,e={hot_comments:[a]},f=$(".comments.part");f.find(".no-comments").hide(),b=f.find(".comment-list").show(),c=this.renderComments(e,!1,!0),d=$(c).find("li"),b.prepend(d)},k.playMusic=function(){},k.stopMusic=function(){$(".wrapper").find(".music .play-button.playing").removeClass("playing").addClass("stop")},k.renderTimeline=function(a,b){return a.items=a.time_lines,e.call(this,"#timeline-tmpl",a,b,function(a){for(var b,c=0,d=a.items.length;d>c;++c)b=a.items[c],b.time=$utils.formatDate(b.pdate,{format:"{year}.{month,2,0}.{date,2,0}"});return a})},k.renderVoteSimple=function(a,b,c){return e.call(this,"#vote-simple-tmpl",a,c,function(a){return a.hasPageButton=!!b,a})},k.renderShareButtons=function(b,c){return!a.$wap||a.$isWeixin?e.call(k,"#share-buttons-tmpl",b,c,null,!1):$.noop},k.renderDingyue=function(b,c){return a.$debug===!0&&console.log("$ContentRender.renderDingyue("+JSON.stringify(b)+");"),e.call(this,"#mod-dingyue-tmpl",b,c,function(b){var c=$(".wrapper").width()-2*$pageHPadding;if(b.subscribeData.icon){var d=(b.subscribeData.icon.match(/size=(\d+).*?(\d+)/),.13);b.subscribeData._width=parseInt(c*d),b.subscribeData._height=parseInt(c*d),b.subscribeData._img=$utils.dmfd(b.subscribeData.icon,b.subscribeData._width,b.subscribeData._height,!0)}return a.$wap||a.$isWeixin?b.subscribeData._share=1:b.subscribeData._share=0,b})},k.dingyueSuccess=function(){a.$debug===!0&&console.log("$ContentRender.dingyueSuccess();");var b=$(".dingyue_button button");b.addClass("subscribed"),b.text("已订阅"),b.data("success",!0)},k.renderSeparator=function(b){a.$debug===!0&&console.log("$ContentRender.renderSeparator();");var c=b===!0?'<div class="separator"></div>':'<div class="separator2"></div>';$(".wrapper").last().append(c)},k.renderGap=function(){$(".wrapper").last().append('<div class="gap"></div>')},k.renderRecommendArtices=function(b,c){a.$debug===!0&&console.log("$ContentRender.renderRecommendArtices("+JSON.stringify(b)+");");var d=$(".wrapper"),f=d.width()-2*$pageHPadding;return e.call(this,"#recommend-articles-tmpl",b,c,function(a){a.related&&a.related.length>0&&a.related.forEach(function(b,c){b.pdate&&(b.elapse=$utils.elapse(b.pdate)),b.source=b.src,b.imgurl?(b.imgurl=b.imgurl.split("|")[0],b.width=f,b.height=f/2,b.img=$utils.dmfd(b.imgurl,f,b.height)):b.img=b.imgurl,c!=a.related.length-1&&(b.separator=!0)}),a.style="";var b=$("section:last");return b.attr("class").indexOf("comments")>=0&&b.is(":visible")&&(a.style="margin-top: 60px;"),a})},k.renderEditorArticleList=function(b,c){if(a.$debug===!0&&console.log("$ContentRender.renderEditorArticleList("+JSON.stringify(b)+");"),$.isArray(b)&&b.length){var d=$(".wrapper"),f=d.width()-2*$pageHPadding;return e.call(this,"#editor-article-list-tmpl",b,c,function(a){return a.forEach(function(a,b){a.pdate&&(a.elapse=$utils.elapse(a.pdate)),a.source=a.src,a.imgurl&&(a.imgurl=a.imgurl.split("|")[0],a.width=Math.floor(f/3.3),a.height=Math.floor(3*a.width/4),a.img=$utils.dmfd(a.imgurl,a.width,a.height))}),a})}},k.renderAd=function(b,c){if(a.$debug===!0&&console.log("$ContentRender.renderAd("+JSON.stringify(b)+");"),$.isArray(b)&&b.length){var d=$(".wrapper"),f=d.width()-2*$pageHPadding;return e.call(this,"#news-detail-ad-tmpl",b,c,function(a){return $.each(a,function(a,b){b.contentimg&&(b._imgWidth=Math.floor(f/3.3),b._imgHeight=Math.floor(3*b._imgWidth/4)),b._title=b.title||"",b.desc&&(b._title+=", "+b.desc)}),a})}},k.renderThirdPartyZhushou=function(a,b,c,d){return e.call(this,"#third-party-zhushou-tmpl",a,b,function(a){return a},c,d)};var q={time_line:"Timeline"};k.renderExtend=function(b){if(a.$debug===!0&&console.log("$ContentRender.renderExtend("+JSON.stringify(b)+");"),b&&b.data&&(b.data.mood1&&$(".wrapper").trigger("onRenderExtend",[b.data.mood1]),b.data.extend))for(var c,d,e,f=b.data.extend,g=b.data.extend.detailorder.split(","),h=0,i=g.length;i>h;++h)c=g[h],methodName="render"+q[c],d=k[methodName],d?(e=f[c],e?d.call(k,e):console.log("//"+c+" data is missing!")):console.log("//Can not render "+c+", check your spelling")},k.renderCommentsCompose=$.noop,k.done=function(){a.$debug===!0&&console.log("$ContentRender.done();");var b=$(".wrapper");b.trigger("done"),b.data("done",!0),console.log("//渲染完成,总耗时"+n+"ms!")},function(b){function c(b,d){var e=new Image,f=b.getAttribute("data-src");e.onload=function(){var a=$(b);a.removeClass("lazy error loading"),a.hasClass("_native-call")&&(a.addClass("native-call"),a.removeClass("_native-call")),b.parent?b.parent.replaceChild(e,b):(b.src=f,$(b).removeClass("lazy")),$nativeApi.news.articleImgLoaded(b.src),d&&d()},e.onerror=function(){var a=$(b);a.hasClass("native-call")&&a.addClass("_native-call"),a.addClass("error lazy").removeClass("native-call loading").off("tap").tap(function(){a.addClass("loading"),c(b,d)})},a.$debug&&console.log("//加载"+f),e.src=f}function d(a,b){var c=a.ele.getBoundingClientRect(),d=m.height(),e=m.scrollTop(),f=c.top+e,g=f+c.height;return e>=f?g>=e-d:e+2*d>=f}function e(b){var c=0,d=b.length,e=[];for(a.$debug&&console.log("//懒加载"+d+"张图"),c;d>c;++c)e.push({ele:b[c],rect:b[c].getBoundingClientRect()});return e}function f(a,b){return d(a[b],b)?(c(a[b].ele,function(){a[b]=null}),!0):!1}function g(){var b=new Date;if(null==i&&(i=e($("img.lazy")),a.$debug&&(a.$images=i)),0===i.length)return void(j||(i=null));l=b;for(var c=0,d=0;d<i.length;d++)null!=i[d]?f(i,d):c++;c==i.length&&(i.length=0,j=!0)}var h=function(a,c){b.addEventListener?this.addEventListener(a,c,!1):b.attachEvent?this.attachEvent("on"+a,c):this["on"+a]=c},i=null,j=!1,l=null;h("scroll",g),k.lazyLoadImage=function(){a.$debug===!0&&console.log("$ContentRender.lazyLoadImage();"),g()}}(this);var r={small:"small",normal:"normal",big:"big",extraBig:"extra-big"};a.adjustFontSize=function(a){var c=r[a]||"normal";$(".wrapper").attr("class","wrapper").addClass(c),b()},a.$ContentRender=k,$ContentRender.weixinShareData={}}(this);