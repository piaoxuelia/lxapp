/*! lxapp 2015-12-23 */
!function(a){function b(){return a.$key||$utils.tryget($datum,"article.url",null)}function c(){return(+(l.uniform()+"").substr(2)).toString(16).substr(0,8)}function d(a){if(!a)return"";var b=a.indexOf(o),c=a.indexOf(p);return htmlOfUl=a.substring(b+o.length,c).replace(/\n\t+/g,"\n"),ulEle=$(htmlOfUl),ulEle.children()}function e(){var a,b,c,d=$(".exp-feeling").find("ul");d.length&&(a=d.find("li"),c=d[0].getBoundingClientRect(),b=c.right-c.left-1,a.css("width",parseInt(b/a.length)))}function f(a,b){a.each(function(a){var c=$(this),d=c.width(),e=d*b;c.css({height:e+"px"})})}var g=$(".wrapper"),h=a.$apis={baseUrl:"http://jk.kandian.360.cn/index.php",commentUrl:"http://web.comment.kandian.360.cn/"},i="3DDDC1DC6A27A2EF649325B334109296",j="3.0.1",k="kandian_wap",l=new RNG,m="application/json; charset=utf-8",n=a.$ContentRender,o=(a.render,"<!-- comment-items-begin -->"),p="<!-- comment-items-end -->";h.getNewsComments=function(a,d){var e=b(),f="",g=c();verify=md5([i,e,f||0,0,g].join(""))+g;var j={type:"get",dataType:"jsonp",url:h.commentUrl+"fetchcomment",contentType:m,jsonpCallback:"__callback_getNewsComments",data:{key:e,comment_id:f,pointer:0,verify:verify,src:k},success:a||$.noop,error:d||$.noop};return $.ajax(j)},h.writeCommentAnonymously=function(a,c,d){var e={type:"get",dataType:"jsonp",url:h.baseUrl+"?mo=news&ro=comment&ra=addanon&_cv=1&f=jsonp",contentType:m,data:{url:b(),content:a},success:c||$.noop,error:d||$.noop};return $.ajax(e)},h.getUserFeelingAboutNews=function(a,c){var d={type:"get",dataType:"jsonp",url:h.baseUrl,contentType:m,jsonpCallback:"__callback_getUserFeelingAboutNews",data:{mo:"news",ro:"support",ra:"getmood",_cv:j,f:"jsonp",typ:0,url:b()},success:a||$.noop,error:c||$.noop};return $.ajax(d)},h.expressFeelingAboutNews=function(a,c,d){var e={type:"get",dataType:"jsonp",url:h.baseUrl,contentType:m,jsonpCallback:"__callback_expressFeelingAboutNews",data:{mo:"news",ro:"support",ra:"addmood",_cv:j,f:"jsonp",typ:0,url:b(),mood:a},success:c||$.noop,error:d||$.noop};return $.ajax(e)},h.likeThisComment=function(a,d,e){var f=b(),g=a,j=c(),l="good",n=md5([i,f,l,g,j].join(""))+j,o={type:"get",dataType:"jsonp",url:h.commentUrl+"punch",contentType:m,jsonpCallback:"__callback_likeThisComment",data:{key:f,attitude:l,comment_id:g,verify:n,src:k},success:d||$.noop,error:e||$.noop};return $.ajax(o)},n.renderCommentsCompose=function(){return n.makeNoPreprocessRender("#comments-compose-tmpl")}(),~function(){g.on("click","a",function(a){a.preventDefault();var b,c=$(this),d=c.attr("href");if(d&&!d.match(/^(javascript|#).*$/)){if(a.stopImmediatePropagation(),b=$utils.getParam("data",d)){try{b=Base64.decode(b),b=JSON.parse(b)}catch(a){}$.isPlainObject(b)&&(location.href=b.ourl||d)}return location.href=d,!1}})}();var q=function(){var a=$utils.getParam("from"),b=$('<div class="third-party-loading"><div class="loading"></div></div>'),c=$('<div class="wrapper-zhushou"></div>'),d=$('<div class="zhushou-pack-up"><a href="javascript:;" class="pack-up" data-content="点击收起全文"></a></div>'),e=$("body"),f="zhushou",h=["http://openbox.mobilem.360.cn/html/api/js/qstore.js","http://openbox.mobilem.360.cn/html/api/js/AppStatusMgr.js"],i=function(){return a==f},j=function(){c.on("click",function(a){var b=$(a.target);b.is("a.more")&&(a.preventDefault(),b.hide(),e.removeClass("third-party-zhushou"),!e.find(d).length&&c.after(d),c.addClass("pack-up"),d.show())}),e.on("click",".zhushou-pack-up a.pack-up",function(a){a.preventDefault(),d.hide(),e.addClass("third-party-zhushou"),c.removeClass("pack-up").find("a.more").show()})},k=function(a,b){$("<script>").attr({src:a}).on("load",b).appendTo("body")},l=function(a,b){var c=a.length,d=0,e=function(){c>d?k(a[d++],e):b&&b()};e()};return{prepare:function(){i()&&e.addClass("third-party third-party-oh").append(b)},init:function(){if(i()){var a=$utils.getParam("zhushouid")||$utils.getParam("id")||/h5\.kandian\.360\.cn/.test(location.host)&&location.pathname.split("/").pop().slice(0,-5)||$datum.article.nid;a&&$.ajax({url:"http://openbox.mobilem.360.cn/mix/getKandianApps/id/"+a,type:"get",dataType:"jsonp",timeout:3e4,success:function(a,b,d){a&&a.data&&a.data.length&&(e.addClass("third-party-zhushou"),$ContentRender.renderThirdPartyZhushou(a,!0,!1,c),j(),g.after(c),l(h,function(){AppStatusMgr.ready(function(){AppStatusMgr.start()})}))},error:function(a,b){},complete:function(a,c){e.removeClass("third-party-oh"),b.remove()}})}}}}();q.prepare();g.on("partDone",function(a,b){function c(){j.find("b").text(i.val().length)}function e(){setTimeout(function(){window.scrollTo(0,j.offset().top)},500)}function f(a){a=a||!1,$apis.getNewsComments(function(b){if(b&&0==b.status&&b.data&&b.data.comments&&0!=b.data.comments.length){var c=n.renderComments(b.data,!1,!0);if(a)$(".comments.part").replaceWith(c);else{var e=d(c);$(".comment-list").append(e).show(),$(".no-comments").hide()}}})}if(b.indexOf("#comments-compose-tmpl")>=0){var i=$("#comment-content"),j=$(".comments-compose.part"),k=$(".exp-feeling").height();g.height()+k;i.change(c).on("keyup input paste",c).focus(function(){m.hide(),e()}).blur(e);var l=$("#pub-comment"),m=$("#comment-prompt");m.dismiss=function(a,b){var c=this;a&&this.text(a),setTimeout(function(){c.hide()},b)},l.click(function(){var a=i.val();return a&&0!==a.length?a.length>140?void m.show().dismiss("评论字数不得多于140字!",5e3):(l.attr("disabled",!0),void h.writeCommentAnonymously(a,function(a){if(!a||"succ"!=a.msg){l.removeAttr("disabled");var b;switch(a.status){case"102":b="评论内容过长!";break;case"109":b="评论太频繁!";break;case"112":b="评论内容为空!";break;default:b="评论失败!"}return void m.show().dismiss("109"==a.status?"操作过于频繁！":"评论失败!",5e3)}m.show().dismiss("评论成功!",5e3),a.time=a.data,a.time_total=1;var c=n.renderComments(a,!1,!0),e=d(c);$(".comment-list").prepend(e).show(),i.val(""),$(".comments-compose.part").find("b").text(0),l.removeAttr("disabled"),$(".no-comments").hide()},function(){m.show().dismiss("评论失败!",5e3),l.removeAttr("disabled")})):void m.show().dismiss("请写评论!",5e3)})}else b.indexOf("#comments-tmpl")>=0?f(!0):b.indexOf("#article-tmpl")>=0}).on("done",function(){e();var a=g.find("object"),b=.56;f(a,b)}),a.$nativeSimulator.$_news.OnClickCmtLike=function(a){var b=this;return h.likeThisComment(a,function(a){if(a&&"succ"==a.msg){var c=b.hasClass("thumb-beat");c||(b.hide(),b.next().show()),b.next().addClass("thumb-beat")}}),!0},window.$wap=!0}(this);